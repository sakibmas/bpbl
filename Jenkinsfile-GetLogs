pipeline {
    agent {
        label params.AgentNode
    }
    stages {
        stage('Get Logs') {
            steps {
                powershell  '''$DestinationPath="$PWD\\logs"
                               if(!(Test-Path "$DestinationPath" -PathType Container)){
                                 New-Item -ItemType Directory -Path "$DestinationPath"
                               }
                               $LogFileList=Get-ChildItem $LogPath -File
                               $LogFileList
                               $LogFileFiltered = $LogFileList | Where-Object{$_.LastWriteTime -gt (Get-Date).AddDays(-$Days).Date}
                               $LogFileFiltered
                               $LogFileFiltered | ForEach-Object{Copy-Item $_.FullName -Destination "DestinationPath" -Force}'''
            }
        }
    }
    post {
              always {
                 emailext mimeType:'text/html',
                    from: 'jenkins@bergerbd.com',
                    subject: "${JOB_NAME} ${currentBuild.currentResult}",
                    to: "${recipientEmails}",
                    attachLog: true,
                    body: """Build Number: ${BUILD_NUMBER} <br>
                             Node Name: ${NODE_NAME} <br>
                             Workspace: ${WORKSPACE} <br>
                             Artifacts: ${RUN_ARTIFACTS_DISPLAY_URL} <br>
                             For details please browse ${BUILD_URL}console"""
              }


    }
}
