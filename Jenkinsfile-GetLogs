pipeline {
    agent {
        label params.AgentNode
    }
    stages {
        stage('Get Logs') {
            steps {
                powershell  '''Get-Date
                               $PWD
                               Get-ChildItem $PWD
                               if(Test-Path "$PWD\\logs" -PathType Leaf){Get-ChildItem "$PWD\\logs"}else{New-Item -ItemType Directory -Path "$PWD\\logs"}
                               Get-ChildItem $LogPath\\*.log -File | Where-Object{$_.LastWriteTime -gt (Get-Date).AddDays(-$Days).Date} | ForEach-Object{Copy-Item $_.FullName -Destination "$PWD\\logs" -Force}'''
            }
        }
    }
    post {
              always {
                 emailext mimeType:'text/html',
                    from: 'jenkins@bergerbd.com',
                    subject: "${JOB_NAME} ${currentBuild.currentResult}",
                    to: "${recipientEmails}",
                    attachLog: true,
                    body: """Build Number: ${BUILD_NUMBER} <br>
                             Node Name: ${NODE_NAME} <br>
                             Workspace: ${WORKSPACE} <br>
                             Artifacts: ${RUN_ARTIFACTS_DISPLAY_URL} <br>
                             For details please browse ${BUILD_URL}console"""
              }


    }
}
